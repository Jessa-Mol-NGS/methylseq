process {
    withName: SAMTOOLS_VIEW {
        ext.prefix = { "${meta.id}.view" }
        publishDir = [
            [
                path: { "${params.outdir}/samtools/view/" },
                mode: params.publish_dir_mode,
                pattern: "*"
            ]
        ]
    }
    
    withName: SAMTOOLS_VIEW_PROPERLY_PAIRED {
        ext.prefix = params.skip_deduplication ? { "${meta.id}.name.sorted.properly.paired" } : { "${meta.id}.deduplicated.name.sorted.properly.paired" }
        ext.args = { "--output-fmt bam --with-header --require-flags 0x2" }
        publishDir = [
            [
                path: { "${params.outdir}/${params.aligner}/deduplicated/" },
                mode: params.publish_dir_mode,
                pattern: "*.deduplicated.name.sorted.properly.paired.bam"
            ],
            [
                path: { "${params.outdir}/${params.aligner}/alignments/" },
                mode: params.publish_dir_mode,
                pattern: "*.name.sorted.properly.paired.bam",
                enabled: params.skip_deduplication
            ]
        ]
    }
}
